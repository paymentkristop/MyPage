<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="Kris Kirby">
    <meta name="copyright" content="LSS Guides developed by K.R.I.S K.I.R.B.Y">
    <title>Sgt Kirby's LSS Guides</title>
    <style>
        :root {
            /* Brand Colors - RLC & Professional IT */
            --rlc-blue: #0f1c3f;
            --rlc-gold: #d4af37;
            --rlc-red: #c00;
            
            --bg-app: #f0f2f5;
            --bg-panel: #ffffff;
            --bg-sidebar: #1a2236;
            
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #e5e7eb;
            
            --accent-blue: #3b82f6;
            --border-color: #e5e7eb;
            
            /* VITAL Terminal Theme */
            --term-bg: #0c0c0c;
            --term-text: #00ff00;
            --term-bar: #1f1f1f;
            
            /* Transitions */
            --trans-speed: 0.4s;
        }

        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        /* SCROLLBARS */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* ===========================
           COVER PAGE
           =========================== */
        #cover-page {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #162a5a 0%, #080e1f 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px;
        }

        #cover-page.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }

        .rlc-badge-container {
            margin-bottom: 30px;
            animation: bounce 3s infinite ease-in-out;
            filter: drop-shadow(0 0 25px rgba(212, 175, 55, 0.4));
        }

        .rlc-badge-container img { width: 180px; height: auto; }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .cover-title {
            font-size: 3.5rem;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-weight: 800;
            background: linear-gradient(to right, #fff, var(--rlc-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
            text-align: center;
        }

        .cover-subtitle {
            color: var(--rlc-gold);
            font-size: 1.1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 10px;
            margin-bottom: 50px;
            border-bottom: 1px solid var(--rlc-gold);
            padding-bottom: 5px;
            text-align: center;
        }

        .launch-grid {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }

        .launch-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 20px 40px;
            color: #fff;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            min-width: 200px;
        }

        .launch-btn:hover {
            background: var(--rlc-gold);
            color: var(--rlc-blue);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
        }

        .launch-btn::after {
            content: 'â†’';
            position: absolute;
            right: 20px;
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s;
        }

        .launch-btn:hover::after {
            opacity: 1;
            transform: translateX(0);
        }

        .lsai-btn-container {
            margin-top: 10px;
            text-align: center;
        }

        /* TEST CHALLENGE BOX */
        .test-challenge-box {
            margin-top: 40px;
            padding: 15px 40px;
            border: 2px solid var(--rlc-gold);
            background: rgba(15, 28, 63, 0.6);
            color: var(--rlc-gold);
            font-family: 'Consolas', monospace;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
            border-radius: 4px;
        }

        .test-challenge-box:hover {
            background: var(--rlc-gold);
            color: var(--rlc-blue);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);
            transform: scale(1.05);
        }

        .test-challenge-box::before { content: '[ '; margin-right: 10px; }
        .test-challenge-box::after { content: ' ]'; margin-left: 10px; }

        /* ===========================
           TEST HUB & UI
           =========================== */
        #test-hub {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #080e1f;
            z-index: 6000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s;
        }

        #test-hub.visible { display: flex; opacity: 1; }

        .hub-title {
            color: #fff; font-size: 2rem; margin-bottom: 50px; 
            text-transform: uppercase; letter-spacing: 5px;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .hub-cards { display: flex; gap: 40px; }

        .hub-card {
            width: 250px; height: 300px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
        }

        .hub-card:hover {
            transform: translateY(-10px);
            background: rgba(255,255,255,0.1);
            border-color: var(--rlc-gold);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .hub-card h3 { color: #fff; font-size: 1.5rem; margin-top: 20px; }
        .hub-card-icon { font-size: 3rem; color: var(--rlc-gold); }
        
        /* Vital Test UI */
        #vital-test-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 7000;
            display: none;
            flex-direction: column;
            color: #0f0;
            font-family: 'Consolas', monospace;
            padding: 20px;
        }

        .vt-header {
            border-bottom: 2px solid #0f0;
            padding-bottom: 10px;
            display: flex; justify-content: space-between;
            margin-bottom: 30px;
            position: relative; z-index: 2;
        }
        
        .vt-content {
            flex: 1;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            display: flex; flex-direction: column; gap: 20px;
            position: relative; z-index: 2;
            overflow-y: auto;
        }

        .vt-question-box {
            border: 1px solid #333;
            background: #111;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
        }

        .vt-question-text { font-size: 1.2rem; color: #fff; margin-bottom: 20px; line-height: 1.5; }
        .vt-question-image { max-width: 100%; max-height: 250px; border: 1px solid #333; margin-bottom: 15px; display: block; }

        .vt-options { display: flex; flex-direction: column; gap: 10px; }

        .vt-option-btn {
            background: #000;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 15px;
            text-align: left;
            cursor: pointer;
            font-family: 'Consolas', monospace;
            transition: all 0.2s;
        }
        .vt-option-btn:hover { background: rgba(0, 255, 0, 0.2); }
        .vt-option-btn.correct { background: #0f0; color: #000; border-color: #0f0; }
        .vt-option-btn.wrong { background: #c00; color: #fff; border-color: #c00; animation: shake 0.5s; }

        .vt-terminal-input {
            background: #000;
            border: none;
            border-bottom: 2px solid #0f0;
            color: #0f0;
            width: 100%;
            padding: 10px;
            font-family: 'Consolas', monospace;
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .vt-next-btn {
            align-self: flex-end;
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 30px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            display: none; /* Hidden until answered */
        }

        .crt-effect {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            position: absolute; top:0; left:0; width:100%; height:100%;
            z-index: 1;
        }

        @keyframes shake {
            0% { transform: translateX(0); } 25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); } 75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* ===========================
           TEST ADMIN (HIDDEN)
           =========================== */
        .vt-admin-trigger {
            position: absolute; bottom: 0; right: 0; width: 30px; height: 30px; z-index: 9999; cursor: pointer;
        }
        
        #vt-admin-panel {
            position: absolute; top: 5%; left: 5%; width: 90%; height: 90%;
            background: #050505; border: 2px solid #0f0;
            z-index: 8000; display: none; padding: 20px;
            flex-direction: column; box-shadow: 0 0 50px rgba(0,255,0,0.2);
        }

        #vt-admin-panel h2 { color: #0f0; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; }
        
        .vt-admin-grid { display: grid; grid-template-columns: 300px 1fr; gap: 20px; height: 100%; overflow: hidden; }
        
        .vt-admin-list { overflow-y: auto; border-right: 1px solid #333; padding-right: 10px; }
        .vt-admin-item { 
            padding: 10px; border-bottom: 1px solid #222; cursor: pointer; color: #888; display: flex; justify-content: space-between;
        }
        .vt-admin-item:hover { color: #fff; background: #111; }
        .vt-admin-item.active { color: #0f0; background: #1a1a1a; border-left: 3px solid #0f0; }

        .vt-admin-form { overflow-y: auto; padding: 10px; }
        
        .vt-form-group { margin-bottom: 15px; }
        .vt-form-group label { display: block; color: #0f0; margin-bottom: 5px; font-size: 0.8rem; }
        .vt-form-group input, .vt-form-group select, .vt-form-group textarea {
            width: 100%; background: #111; border: 1px solid #333; color: #fff; padding: 8px; font-family: 'Consolas', monospace;
        }
        .vt-form-group input:focus { border-color: #0f0; }

        .vt-btn { padding: 8px 15px; border: 1px solid #0f0; background: transparent; color: #0f0; cursor: pointer; font-family: 'Consolas', monospace; margin-right: 10px; }
        .vt-btn:hover { background: #0f0; color: #000; }
        .vt-btn.danger { border-color: #c00; color: #c00; }
        .vt-btn.danger:hover { background: #c00; color: #fff; }

        /* ===========================
           APP LAYOUT
           =========================== */
        #app-container {
            display: flex;
            height: 100vh;
            opacity: 0;
            transform: scale(0.98);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #app-container.visible {
            opacity: 1;
            transform: scale(1);
        }

        /* Mobile Header (Hidden on Desktop) */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%;
            height: 60px;
            background: var(--rlc-blue);
            z-index: 3000; /* Extremely High */
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .mobile-menu-btn {
            background: transparent;
            border: none;
            color: var(--rlc-gold);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px; /* Larger touch target */
        }

        .mobile-title {
            color: #fff;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .mobile-logo { height: 35px; width: auto; }

        /* Mobile Overlay Mask */
        .mobile-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000; /* Below sidebar, above content */
            display: none;
            backdrop-filter: blur(3px);
            transition: opacity 0.3s;
        }

        /* SIDEBAR NAVIGATION */
        .sidebar {
            width: 300px;
            background-color: var(--bg-sidebar);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.1);
            box-shadow: 5px 0 15px rgba(0,0,0,0.2);
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .sidebar-header {
            padding: 25px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-trigger-logo { 
            width: 40px; 
            height: auto; 
            cursor: pointer; 
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        .admin-trigger-logo:hover { opacity: 1; }

        .sidebar-header h2 { margin: 0; font-size: 1.2rem; font-weight: 700; color: #fff; cursor: default; }
        .sidebar-header span { font-size: 0.7rem; color: var(--rlc-gold); text-transform: uppercase; display: block; cursor: default; }

        .nav-scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: none; 
        }
        
        .nav-scroll-area.active {
            display: block;
        }

        .nav-group { margin-bottom: 10px; }

        .nav-trigger {
            width: 100%;
            text-align: left;
            background: transparent;
            border: none;
            color: #9ca3af;
            padding: 12px 15px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-trigger:hover { background: rgba(255,255,255,0.05); color: #fff; }

        .nav-trigger.active {
            background: linear-gradient(90deg, var(--rlc-blue), rgba(15, 28, 63, 0));
            color: var(--rlc-gold);
            border-left: 3px solid var(--rlc-gold);
        }

        .nav-trigger .arrow { font-size: 0.7rem; transition: transform 0.3s; }
        .nav-trigger.active .arrow { transform: rotate(180deg); }

        .nav-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
            padding-left: 15px;
        }

        .nav-content.open { max-height: 1000px; }

        .nav-link {
            display: block;
            padding: 10px 15px;
            color: #9ca3af;
            text-decoration: none;
            font-size: 0.85rem;
            border-left: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
        }

        .nav-link:hover {
            color: #fff;
            border-left-color: var(--rlc-gold);
            background: rgba(255,255,255,0.02);
        }

        .home-btn {
            margin: 15px;
            padding: 12px;
            background: var(--rlc-red);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.2s;
        }
        .home-btn:hover { background: #b91c1c; }

        /* MAIN CONTENT */
        .main-viewport {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            background-color: #f3f4f6;
            position: relative;
        }

        .doc-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            overflow: hidden;
            min-height: 80vh;
        }

        .doc-header {
            background: var(--rlc-blue);
            color: #fff;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        .doc-header::after {
            content: '';
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            background: repeating-linear-gradient(45deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 10px, transparent 10px, transparent 20px);
        }

        .doc-header h1 { margin: 0; font-size: 2rem; z-index: 1; position: relative; }
        .doc-header p { color: rgba(255,255,255,0.7); z-index: 1; position: relative; }
        .credit-pill {
            position: absolute;
            top: 20px; right: 20px;
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid var(--rlc-gold);
            color: var(--rlc-gold);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            z-index: 2;
        }

        .content-body { padding: 40px; }

        /* STEP CARDS */
        .step-block {
            display: grid;
            grid-template-columns: 50px 1fr;
            gap: 20px;
            margin-bottom: 40px;
            position: relative;
        }

        .step-block::before {
            content: '';
            position: absolute;
            left: 24px;
            top: 50px;
            bottom: -30px;
            width: 2px;
            background: #e5e7eb;
            z-index: 0;
        }

        .step-block:last-child::before { display: none; }

        .step-marker {
            width: 50px;
            height: 50px;
            background: var(--rlc-blue);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(15, 28, 63, 0.3);
            z-index: 1;
            position: relative;
        }

        .step-detail {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 25px;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .step-detail:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border-color: var(--accent-blue);
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--rlc-blue);
            margin-bottom: 10px;
            display: block;
        }

        .step-text {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        /* TERMINAL SIMULATOR */
        .terminal-window {
            background: var(--term-bg);
            border-radius: 6px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            overflow: hidden;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            border: 1px solid #333;
        }

        .terminal-bar {
            background: var(--term-bar);
            padding: 5px 10px;
            display: flex;
            gap: 6px;
            border-bottom: 1px solid #333;
        }

        .term-dot { width: 10px; height: 10px; border-radius: 50%; }
        .red { background: #ff5f56; }
        .yellow { background: #ffbd2e; }
        .green { background: #27c93f; }

        .terminal-content {
            padding: 15px;
            color: var(--term-text);
            font-size: 0.85rem;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .term-hl { color: #fff; font-weight: bold; background: rgba(255,255,255,0.2); }
        .term-cursor {
            display: inline-block;
            width: 8px;
            height: 15px;
            background: var(--term-text);
            animation: blink 1s infinite;
            vertical-align: middle;
        }

        @keyframes blink { 50% { opacity: 0; } }

        /* UPLOAD AREA */
        .upload-zone {
            border: 2px dashed #cbd5e1;
            background: #f9fafb;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
            position: relative;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .upload-zone img {
            max-width: 100%;
            max-height: 300px;
            display: none;
            border-radius: 4px;
        }

        .upload-text { font-size: 0.85rem; color: #6b7280; font-weight: 600; }
        .upload-icon { font-size: 1.5rem; color: #9ca3af; margin-bottom: 10px; }

        /* DOCUMENT VIEWER FOR LSA&I */
        .doc-viewer-container {
            margin-top: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #fff;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: relative;
        }
        .doc-viewer-frame { width: 100%; height: 100%; border: none; border-radius: 8px; }
        .doc-viewer-placeholder { text-align: center; padding: 40px; color: #6b7280; }

        /* KEYBOARD SHORTCUTS */
        kbd {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.8em;
            font-weight: 600;
            color: #374151;
            box-shadow: 0 1px 0 #d1d5db;
        }

        /* FOOTER */
        .protected-footer {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: rgba(15, 28, 63, 0.95);
            color: var(--rlc-gold);
            text-align: center;
            padding: 10px;
            font-size: 0.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            border-top: 1px solid var(--rlc-gold);
            z-index: 9999;
            backdrop-filter: blur(5px);
            pointer-events: none;
        }

        /* Section Title Styling */
        h3 {
            color: var(--rlc-blue);
            border-bottom: 2px solid var(--rlc-gold);
            padding-bottom: 10px;
            margin-top: 40px;
            font-size: 1.5rem;
        }

        /* INVISIBLE ADMIN TRIGGER (Bottom Right) */
        .admin-trigger-secret {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background: transparent;
            z-index: 10000;
            cursor: default;
        }

        /* ADMIN PANEL & UTILS */
        #signature-lock-k-r-i-s-k-i-r-b-y { display: none; visibility: hidden; }
        
        #admin-login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 10000;
            display: none; justify-content: center; align-items: center;
        }
        .login-box {
            background: #fff; padding: 30px; border-radius: 8px; text-align: center;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .login-box input {
            padding: 10px; font-size: 1.2rem; text-align: center; letter-spacing: 5px; width: 150px;
            margin-bottom: 15px; border: 2px solid #333; border-radius: 4px;
        }
        .login-box button {
            padding: 10px 20px; background: var(--rlc-blue); color: #fff; border: none;
            border-radius: 4px; cursor: pointer; font-weight: bold;
        }

        #admin-panel {
            position: fixed; top: 0; right: -400px; width: 350px; height: 100%;
            background: #2d3748; color: #fff; z-index: 9999;
            box-shadow: -5px 0 15px rgba(0,0,0,0.3);
            transition: right 0.3s ease; padding: 20px; overflow-y: auto;
        }
        #admin-panel.open { right: 0; }
        
        .admin-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; border-bottom: 1px solid #4a5568; padding-bottom: 10px;
        }
        
        .admin-section {
            margin-bottom: 20px; padding: 15px; background: #1a202c; border-radius: 6px;
        }
        .admin-section h4 { margin-top: 0; color: var(--rlc-gold); border-bottom: 1px solid #4a5568; padding-bottom: 5px; }
        
        .admin-form-group { margin-bottom: 10px; }
        .admin-form-group label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #a0aec0; }
        .admin-form-group input, .admin-form-group select, .admin-form-group textarea {
            width: 100%; padding: 8px; background: #2d3748; border: 1px solid #4a5568;
            color: #fff; border-radius: 4px;
        }
        
        .admin-btn {
            width: 100%; padding: 10px; background: var(--accent-blue); border: none;
            color: #fff; font-weight: bold; border-radius: 4px; cursor: pointer; margin-top: 5px;
        }
        .admin-btn.save { background: #48bb78; margin-top: 20px; }
        .admin-btn.export { background: #ed8936; margin-top: 10px; }
        .admin-btn.close { background: #f56565; width: auto; padding: 5px 10px; }
        .admin-btn.delete-cat { background: #e53e3e; margin-top: 10px; }

        .editable { border: 2px dashed transparent; }
        body.editing .editable { border-color: var(--accent-blue); cursor: text; }
        body.editing .editable:hover { background: rgba(59, 130, 246, 0.1); }
        .delete-step-btn {
            position: absolute; top: 10px; right: 10px;
            background: #f56565; color: white; border: none;
            border-radius: 4px; padding: 5px 10px; cursor: pointer;
            font-size: 0.8rem; display: none;
        }
        body.editing .delete-step-btn { display: block; }

        .guide-section { display: none; animation: fadeIn 0.5s; }
        .guide-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ==========================================================================
           AMAZING MOBILE EXPERIENCE
           ========================================================================== */
        @media screen and (max-width: 768px) {
            
            /* CRITICAL FIX FOR BLURRY/UNCLICKABLE MENU */
            /* This resets the transform stack that was trapping the menu underneath the overlay */
            #app-container { 
                transform: none !important; 
                opacity: 1 !important;
                display: block; /* Break flexbox */
                padding-top: 60px; /* Space for mobile header */
                height: 100%;
                overflow: hidden;
            }

            /* Enable Mobile Header */
            .mobile-header { display: flex; }

            /* Cover Page - Mobile Optimization */
            .cover-title { font-size: 2.5rem; line-height: 1.1; margin-bottom: 15px; }
            .cover-subtitle { font-size: 0.9rem; margin-bottom: 30px; width: 90%; margin-left: auto; margin-right: auto; }
            .launch-grid { flex-direction: column; width: 100%; gap: 15px; }
            .launch-btn { width: 100%; font-size: 1.1rem; padding: 18px; border-radius: 12px; }
            .rlc-badge-container img { width: 140px; }

            /* App Structure Adjustment */
            body { 
                overflow: hidden; /* Prevent body scroll */
                position: fixed; width: 100%; height: 100%;
            }

            /* Sidebar - Slide-in Drawer */
            .sidebar {
                position: fixed;
                top: 60px; /* Below header */
                left: -100%; /* Hidden by default */
                width: 80%;
                height: calc(100% - 60px);
                border-right: none;
                background: rgba(26, 34, 54, 0.98);
                backdrop-filter: none; /* Removed blur to prevent glitches */
                
                /* EXTREMELY HIGH Z-INDEX + ABOVE OVERLAY */
                z-index: 2500; 
                
                box-shadow: 10px 0 20px rgba(0,0,0,0.5);
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .sidebar-header { display: none; } /* Use mobile header instead */
            .nav-scroll-area { padding-bottom: 100px; }

            /* Main Content - Full Screen & Scrolling */
            .main-viewport {
                width: 100%;
                height: 100%;
                padding: 15px;
                padding-bottom: 80px; /* Space for footer */
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .doc-container {
                border-radius: 0 0 12px 12px;
                box-shadow: none;
                margin-bottom: 30px;
                background: transparent; /* Seamless blend */
            }

            .doc-header {
                border-radius: 12px;
                padding: 25px 20px;
                margin-bottom: 20px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }

            .doc-header h1 { font-size: 1.6rem; }
            .credit-pill { top: 15px; right: 15px; font-size: 0.7rem; background: rgba(0,0,0,0.4); }

            .content-body {
                padding: 0;
                background: transparent;
            }

            /* Enhanced Step Cards for Mobile */
            .step-block {
                display: block; /* Stack */
                background: #fff;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 10px 15px -3px rgba(0,0,0,0.1);
                margin-bottom: 25px;
                border-left: 4px solid var(--rlc-gold); /* Visual accent */
                position: relative;
            }

            .step-block::before { display: none; } /* Remove Desktop connector line */

            .step-marker {
                position: absolute;
                top: -15px;
                right: 15px;
                width: 36px;
                height: 36px;
                font-size: 1rem;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            }

            .step-detail {
                background: transparent;
                border: none;
                padding: 0;
                box-shadow: none;
            }
            .step-detail:hover { transform: none; box-shadow: none; }

            .step-title {
                font-size: 1.2rem;
                padding-right: 40px; /* Space for marker */
                margin-top: 5px;
            }

            /* Terminal - Horizontal Scroll */
            .terminal-window {
                margin: 15px -10px; /* Slightly wider */
                width: calc(100% + 20px);
                border-radius: 4px;
                border-left: none; border-right: none;
            }
            
            .terminal-content {
                font-size: 0.8rem;
                overflow-x: auto;
                white-space: pre; /* Keep code formatting */
                padding: 10px;
            }

            /* Footer adjustment */
            .protected-footer {
                padding-bottom: env(safe-area-inset-bottom);
                font-size: 0.7rem;
            }
            
            .hub-cards { flex-direction: column; }
        }
    </style>
</head>
<body>

    <header class="mobile-header">
        <button class="mobile-menu-btn" onclick="toggleMobileNav()">
            â˜°
        </button>
        <div class="mobile-title">LSS Guides</div>
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/Cap_Badge_of_the_RLC.png" alt="RLC" class="mobile-logo">
    </header>

    <div class="mobile-overlay" id="mobile-overlay" onclick="toggleMobileNav()"></div>

    <div id="signature-lock-k-r-i-s-k-i-r-b-y"></div>

    <div class="admin-trigger-secret" onclick="showAdminLogin()" title=""></div>

    <div id="admin-login-overlay">
        <div class="login-box">
            <h3>Admin Access</h3>
            <input type="password" id="admin-pin" placeholder="PIN" maxlength="4">
            <br>
            <button onclick="checkAdminPin()">Login</button>
            <button onclick="closeAdminLogin()" style="background:#666; margin-left:10px;">Cancel</button>
        </div>
    </div>

    <div id="admin-panel">
        <div class="admin-header">
            <h3>Admin Panel</h3>
            <button class="admin-btn close" onclick="toggleAdminPanel()">X</button>
        </div>

        <div class="admin-section">
            <h4>Edit Mode</h4>
            <p style="font-size: 0.8rem; color: #a0aec0;">Click text in the guide to edit inline.</p>
            <button class="admin-btn" id="toggle-edit-btn" onclick="toggleEditMode()">Enable Text Editing</button>
        </div>

        <div class="admin-section">
            <h4>Add Category/Section</h4>
            <div class="admin-form-group">
                <label>Target Guide</label>
                <select id="target-guide-select">
                    <option value="nav-content-vital">VITAL Guide</option>
                    <option value="nav-content-mjdi">MJDI Guide</option>
                    <option value="nav-content-lsai">LSA&I Tool</option>
                </select>
            </div>
            <div class="admin-form-group">
                <label>Category Title</label>
                <input type="text" id="new-category-title" placeholder="e.g., 9. New Process">
            </div>
            <button class="admin-btn" onclick="addNewCategory()">Add Category</button>
        </div>

        <div class="admin-section">
            <h4>Manage Categories</h4>
            <div class="admin-form-group">
                <label>Select Category to Delete</label>
                <select id="delete-category-select">
                </select>
            </div>
            <button class="admin-btn delete-cat" onclick="deleteCategory()">Delete Category</button>
        </div>

        <div class="admin-section">
            <h4>Add Content Step</h4>
            <div class="admin-form-group">
                <label>Target Section</label>
                <select id="target-section-select">
                </select>
            </div>
            <div class="admin-form-group">
                <label>Step Number</label>
                <input type="text" id="new-step-num" placeholder="e.g. 4">
            </div>
            <div class="admin-form-group">
                <label>Step Title</label>
                <input type="text" id="new-step-title" placeholder="Step Title">
            </div>
            <div class="admin-form-group">
                <label>Instructions</label>
                <textarea id="new-step-text" rows="3"></textarea>
            </div>
            <div class="admin-form-group">
                <label>Include Terminal Box?</label>
                <select id="include-term">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
            <div class="admin-form-group" id="term-content-group" style="display:none;">
                <label>Terminal Content</label>
                <textarea id="new-term-text" rows="3" placeholder="Green screen text..."></textarea>
            </div>
            <button class="admin-btn" onclick="addNewStep()">Add Step</button>
        </div>

        <button class="admin-btn save" onclick="saveChanges()">Save to Browser Memory</button>
        <button class="admin-btn export" onclick="downloadHtml()">Download Updated HTML</button>
        <div id="auto-save-indicator" style="color: #48bb78; font-size: 0.8rem; text-align: center; margin-top: 10px; opacity: 0; transition: opacity 0.5s;">Autosaved</div>
    </div>

    <div id="cover-page">
        <div class="rlc-badge-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/Cap_Badge_of_the_RLC.png" alt="RLC Cap Badge">
        </div>
        <h1 class="cover-title">Sgt Kirby's</h1>
        <div class="cover-subtitle">Logistic Supply Specialist (LSS) Guides</div>
        
        <div class="launch-grid">
            <button class="launch-btn" onclick="enterSystem('vital')">VITAL</button>
            <button class="launch-btn" onclick="enterSystem('mjdi')">MJDI</button>
        </div>

        <div class="lsai-btn-container">
            <button class="launch-btn" onclick="enterSystem('mjdi-lsai')">Latest LSA&I Question Set</button>
        </div>

        <div class="test-challenge-box" onclick="openTestHub()">
            Test Your Knowledge
        </div>

        <div class="protected-footer">Created by Kris Kirby</div>
    </div>

    <div id="test-hub">
        <div class="hub-title">Select Challenge</div>
        <div class="hub-cards">
            <div class="hub-card" style="opacity: 0.5; cursor: not-allowed;">
                <div class="hub-card-icon">ðŸ“š</div>
                <h3>MJDI Test</h3>
                <span style="color:#aaa; font-size:0.8rem; margin-top:10px;">(Coming Soon)</span>
            </div>
            <div class="hub-card" onclick="startVitalTest()">
                <div class="hub-card-icon">âš¡</div>
                <h3>VITAL Test</h3>
                <span style="color:#48bb78; font-size:0.8rem; margin-top:10px;">Ready</span>
            </div>
        </div>
        <button onclick="closeTestHub()" class="home-btn" style="margin-top:50px;">Return to Menu</button>
    </div>

    <div id="vital-test-container">
        <div class="crt-effect"></div>
        <div class="vt-header">
            <div>VITAL TERMINAL SIMULATION v2.4</div>
            <div id="vt-score">SCORE: 0/5</div>
        </div>
        
        <div class="vt-content" id="vt-game-area">
            </div>

        <div class="vt-admin-trigger" onclick="openVtAdmin()"></div>
        
        <button onclick="closeVitalTest()" class="home-btn" style="position: absolute; bottom: 20px; right: 20px; z-index: 7001;">Exit Test</button>
    </div>

    <div id="vt-admin-panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>ROOT ACCESS // TEST CONFIGURATION</h2>
            <button class="vt-btn danger" onclick="closeVtAdmin()">EXIT ADMIN</button>
        </div>
        <div class="vt-admin-grid">
            <div class="vt-admin-list" id="vt-q-list">
                </div>
            <div class="vt-admin-form">
                <input type="hidden" id="vt-edit-index" value="-1">
                <div class="vt-form-group">
                    <label>Question Type</label>
                    <select id="vt-type" onchange="toggleVtFields()">
                        <option value="mc">Multiple Choice</option>
                        <option value="terminal">Terminal Simulation</option>
                        <option value="hotkey">Hotkey Challenge</option>
                    </select>
                </div>
                <div class="vt-form-group">
                    <label>Question Text</label>
                    <textarea id="vt-qtext" rows="3"></textarea>
                </div>
                
                <div class="vt-form-group">
                    <label>Question Image (Optional)</label>
                    <input type="text" id="vt-img-url" placeholder="Paste Image URL">
                    <div style="margin-top:5px; color:#666; font-size:0.8rem;">OR Upload (Auto-converts to Base64 - Keep small!)</div>
                    <input type="file" id="vt-img-upload" accept="image/*" onchange="handleVtImageUpload(this)">
                </div>

                <div id="vt-group-mc">
                    <div class="vt-form-group">
                        <label>Options (Comma Separated)</label>
                        <input type="text" id="vt-options" placeholder="Option 1, Option 2, Option 3, Option 4">
                    </div>
                    <div class="vt-form-group">
                        <label>Correct Option Index (0-3)</label>
                        <input type="number" id="vt-correct-idx" min="0" max="3">
                    </div>
                </div>

                <div id="vt-group-ans" style="display:none;">
                    <div class="vt-form-group">
                        <label>Correct Answer / Key</label>
                        <input type="text" id="vt-answer" placeholder="e.g. CTRL+P or F2">
                    </div>
                </div>

                <div style="margin-top:20px;">
                    <button class="vt-btn" onclick="saveQuestionData()">SAVE QUESTION</button>
                    <button class="vt-btn" onclick="clearVtForm()">NEW QUESTION</button>
                    <button class="vt-btn danger" onclick="deleteQuestionData()">DELETE</button>
                </div>
            </div>
        </div>
    </div>

    <div id="app-container">
        
        <nav class="sidebar" id="sidebar-nav">
            <div class="sidebar-header">
                <img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/Cap_Badge_of_the_RLC.png" alt="RLC" class="admin-trigger-logo" onclick="showAdminLogin()">
                <div>
                    <h2 id="guide-title" class="editable">VITAL Guide</h2>
                    <span>For Dummies</span>
                </div>
            </div>

            <div class="nav-scroll-area" id="nav-content-vital">
                <div class="nav-group" id="group-create-issue">
                    <button class="nav-trigger" onclick="toggleNav(this)">1. Creating & Maint. <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('create-issue')">1.1 Create Issue Pkg</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('maintain-issue')">1.2 Maintain Issue</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('maintain-package')">1.3 Maintain Package</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('deployment-pkg')">1.4 Deployment Pkgs</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('permanent-pkg')">1.5 Permanent Pkgs</a>
                    </div>
                </div>

                <div class="nav-group" id="group-departures">
                    <button class="nav-trigger" onclick="toggleNav(this)">2. Departures <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('direct-despatch-pdr')">2.1 Direct Despatch PDR</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('direct-despatch-pkg')">2.2 Direct Despatch Pkg</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('create-pdr')">2.3 Create PDR (1142)</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('create-awb')">2.4 Create AWB (1380)</a>
                    </div>
                </div>

                <div class="nav-group" id="group-arrivals">
                    <button class="nav-trigger" onclick="toggleNav(this)">3. Arrivals <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('record-arrival')">3.1 Record Arrival</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('node-discrepancies')">3.2 Discrepancies (JSP886)</a>
                    </div>
                </div>

                <div class="nav-group" id="group-templocs">
                    <button class="nav-trigger" onclick="toggleNav(this)">4. Temp Locations <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('temp-locs')">Manage Locations</a>
                    </div>
                </div>

                <div class="nav-group" id="group-earlybird">
                    <button class="nav-trigger" onclick="toggleNav(this)">5. Early Bird <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('early-bird')">Daily Routine</a>
                    </div>
                </div>

                <div class="nav-group" id="group-contracts">
                    <button class="nav-trigger" onclick="toggleNav(this)">6. Contracts <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('contracts')">Leonardo & Safran</a>
                    </div>
                </div>

                <div class="nav-group" id="group-dscom">
                    <button class="nav-trigger" onclick="toggleNav(this)">7. DSCOM & USA <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('dscom')">DSCOM Requests</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('usa-returns')">USA Returns</a>
                    </div>
                </div>

                <div class="nav-group" id="group-managerial">
                    <button class="nav-trigger" onclick="toggleNav(this)">8. Managerial <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('kpis')">Weekly KPIs</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('hhd')">Handheld Devices</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('supervisor-docs')">Supervisor Annexes</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('deletions')">Record Deletion</a>
                    </div>
                </div>
            </div>

            <div class="nav-scroll-area" id="nav-content-mjdi">
                <div class="nav-group">
                    <button class="nav-trigger" onclick="toggleNav(this)">Receipts & Issues <span class="arrow">â–¼</span></button>
                    <div class="nav-content open">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('mjdi-receipts')">Receipts Guide</a>
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('mjdi-issues')">Issues Guide</a>
                    </div>
                </div>

                <div class="nav-group" id="group-mjdi-discrep">
                    <button class="nav-trigger" onclick="toggleNav(this)">Discrepancies <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('mjdi-discrepancies')">Management Guide</a>
                    </div>
                </div>

                <div class="nav-group" id="group-mjdi-loss">
                    <button class="nav-trigger" onclick="toggleNav(this)">Losses <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('mjdi-losses')">Losses Guide</a>
                    </div>
                </div>

                <div class="nav-group" id="group-mjdi-sandr">
                    <button class="nav-trigger" onclick="toggleNav(this)">S&R <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('mjdi-sandr')">S&R Guide</a>
                    </div>
                </div>

                <div class="nav-group" id="group-mjdi-uaa">
                    <button class="nav-trigger" onclick="toggleNav(this)">UAA <span class="arrow">â–¼</span></button>
                    <div class="nav-content">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('mjdi-uaa')">UAA Guide</a>
                    </div>
                </div>
            </div>

            <div class="nav-scroll-area" id="nav-content-lsai">
                <div class="nav-group" id="group-lsai">
                    <button class="nav-trigger" onclick="toggleNav(this)">LSA&I Tools <span class="arrow">â–¼</span></button>
                    <div class="nav-content open">
                        <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('lsai-viewer')">Handbook Viewer</a>
                    </div>
                </div>
            </div>

            <button class="home-btn" onclick="goHome()">Exit System</button>
        </nav>

        <div class="main-viewport">
            <div class="doc-container">
                
                <div class="doc-header">
                    <div class="credit-pill">Sgt Kirby</div>
                    <h1 id="header-main" class="editable">VITAL System Handover</h1>
                    <p id="header-sub" class="editable">Visibility In Transit Asset Logging - Procedural Guide</p>
                </div>

                <div class="content-body">
                    
                    <div id="section-welcome" class="guide-section active">
                        <h3 class="editable">Welcome to VITAL</h3>
                        <p class="editable">Select a procedure from the sidebar to begin.</p>
                        <div class="step-block">
                            <div class="step-marker">â„¹</div>
                            <div class="step-detail">
                                <span class="step-title editable">System Overview</span>
                                <p class="step-text editable">VITAL is the pivotal link between Flight ES imports and external logistics organisations (Kuehne-Nagel, Safran, DE&S). It uses unique identifiers to track consignments within the Joint Supply Chain (JSC) at both fixed base and deployed locations.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-create-issue" class="guide-section">
                        <h3 class="editable">1.1 Create Issue Package</h3>
                        <div class="menu-path editable">Menu: 1. Issues & Packages â†’ Seq. 1 Create Issue Package</div>

                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Input Voucher Data</span>
                                <p class="step-text editable">Navigate to Menu 1 (Issues & Packages) then Sequence 1 (Create Issue Package). Populate the UIN section with the issuing UIN from the bottom left of the U050 voucher. Enter the Date (Issue Date) and Vch No (Top Right of U050).</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar">
                                        <div class="term-dot red"></div><div class="term-dot yellow"></div><div class="term-dot green"></div>
                                    </div>
                                    <div class="terminal-content editable">UIN: <span class="term-hl">F7751A</span>   Date: <span class="term-hl">161123</span>   Vch No: <span class="term-hl">000018245</span><span class="term-cursor"></span></div>
                                </div>
                                <div class="upload-zone" onclick="triggerUpload(this)">
                                    <div class="upload-icon">ðŸ“¸</div>
                                    <span class="upload-text">Click or Drag image here</span>
                                    <input type="file" hidden accept="image/*" onchange="previewImage(this)">
                                    <img src="">
                                </div>
                            </div>
                        </div>

                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Select Final Node</span>
                                <p class="step-text editable">If the Final Node is not auto-populated, use the hotkey <kbd>F3</kbd> to open a list of nodes. Navigate until you find the correct end location node. If unknown, use <code>BIC</code> as a failsafe for EarlyBird consignments.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Final Node: <span class="term-hl">FLM RAF LEEMING</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="step-block">
                            <div class="step-marker">3</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Create Package</span>
                                <p class="step-text editable">Once columns are populated, press <kbd>Ctrl</kbd> + <kbd>P</kbd>. Confirm "One or more Issue records will be updated..." with <kbd>Y</kbd>. Enter the number of packages required (e.g., 1).</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Proceed with creating Packages (y/n)? <span class="term-hl">Y</span>
Enter number of Packages required: <span class="term-hl">1</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="step-block">
                            <div class="step-marker">4</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Package Details</span>
                                <p class="step-text editable">Use <kbd>F10</kbd> to select the Package Type. Weigh the stores and input the weight. Dimensions (L, W, H) usually pre-fill. Press <kbd>Alt</kbd> + <kbd>F2</kbd> to save.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Pkg Type: <span class="term-hl">JIF1</span>    Wt(kg): <span class="term-hl">2.00</span>
L: 25  W: 20  H: 1</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="section-maintain-issue" class="guide-section">
                        <h3 class="editable">1.2 Maintain Issue</h3>
                        <div class="menu-path editable">Menu: 1. Issues & Packages â†’ Seq. 2 Maintain Issue</div>
                        <p class="step-text editable">Use this to manually create an issue on VITAL (e.g., internal issues not interfaced by MJDI).</p>
                        
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Issue & Demand References</span>
                                <p class="step-text editable">Enter UIN (Issue Origin), Date, Voucher, and SPC from the U050. Then enter Demand UIN, Date, and Demand No.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">UIN: <span class="term-hl">F7751A</span>  Date: 12/10/2022  Vch: 22874  SPC: 13</div>
                                </div>
                            </div>
                        </div>

                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Item Details</span>
                                <p class="step-text editable">Enter DMC, NSN, DofQ (Unit of Issue), Quantity, MatCon, Price, and Consignee Unit Title (First line of address).</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">DMC: <span class="term-hl">A1</span>  NSN: <span class="term-hl">7920992571342</span>
Short Name: CLOTH, POLISHING
Press AddNew(Alt&F5)</div>
                                </div>
                            </div>
                        </div>

                        <div class="step-block">
                            <div class="step-marker">3</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Address & Finalise</span>
                                <p class="step-text editable">Press <kbd>Alt</kbd> + <kbd>F5</kbd> to Add New. Enter the full address. Press <kbd>Alt</kbd> + <kbd>F2</kbd> to save. Then use <kbd>Alt</kbd> + <kbd>K</kbd> (Keep) and <kbd>Alt</kbd> + <kbd>E</kbd> (Enter Package Creation).</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-maintain-package" class="guide-section">
                        <h3 class="editable">1.3 Maintain Package (Audit)</h3>
                        <div class="menu-path editable">Menu: 1. Issues & Packages â†’ Seq. 3 Maintain Package</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Interrogate Package</span>
                                <p class="step-text editable">Enter Package ID and press <kbd>F11</kbd>. Check <strong>Transit Ind</strong>: <code>N</code> (Not in transit), <code>I</code> (In transit), <code>E</code> (End). Check <strong>Current Node</strong> and <strong>Final Node</strong>.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Pkg ID: WTM02516743
Transit Ind: <span class="term-hl">I</span>
Current Node: WTM   Next Node: BIC   Final Node: CON</div>
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Audit History</span>
                                <p class="step-text editable">Press <kbd>Alt</kbd> + <kbd>F10</kbd> to view the audit trail (User, Date, Process). Press <kbd>Ctrl</kbd> + <kbd>G</kbd> for Movement Tracking (PDR history).</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-deployment-pkg" class="guide-section">
                        <h3 class="editable">1.4 Deployment Packages</h3>
                        <div class="menu-path editable">Menu: 1. Issues & Packages â†’ Seq. 4 Create Deployment Package</div>
                        <p class="step-text editable">For stores without a linked Issue Voucher (e.g., Unit Moves, PEPs). Requires permission.</p>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Consignment Details</span>
                                <p class="step-text editable">Enter Consignor (You), Reference (WTM/DP/...), Final Node, Consignee (Them), and Address.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Consignor: F7751A   Reference: WTM/DP/001
Final Node: GOS
Consignee: GOSPORT, SAMPLES</div>
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Create Packages</span>
                                <p class="step-text editable">Press <kbd>Ctrl</kbd> + <kbd>P</kbd>. Enter number of packages. Fill in Description, Packaging Type (e.g., STC1), Weight, UNHaz, and Value. Save (<kbd>Alt</kbd> + <kbd>F2</kbd>).</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-permanent-pkg" class="guide-section">
                        <h3 class="editable">1.5 Permanent Packages</h3>
                        <div class="menu-path editable">Menu: 1. Issues & Packages â†’ Seq. 7 Create Permanent Package</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Create ISO/Container</span>
                                <p class="step-text editable">Enter Serial No (e.g., ISO12345). Use <kbd>F10</kbd> to select Pkg Type (e.g., ISO2). Dimensions auto-populate. Press <kbd>Alt</kbd> + <kbd>F5</kbd> to Add New.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Serial No: ISOSJL3432
Pkg Type: ISO2
Desc: ISO CONTAINER 20FT</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="section-direct-despatch-pdr" class="guide-section">
                        <h3 class="editable">2.1 Direct Despatch PDR</h3>
                        <div class="menu-path editable">Menu: 2. Departures & Despatches â†’ Direct Despatch PDR</div>
                        <div class="step-block">
                            <div class="step-marker">âš </div>
                            <div class="step-detail">
                                <span class="step-title editable">Warning</span>
                                <p class="step-text editable">Used when PDRs are Unit collected. You cannot arrive the PDR via the Arrival screen if this option is used.</p>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Process Despatch</span>
                                <p class="step-text editable">Enter PDR Number. Accept warning ("Packages not at Final Node"). Set Next Node to <code>CON</code>. Press <kbd>Alt</kbd>+<kbd>F2</kbd>.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">PDR: WTM02507761
Next Node: <span class="term-hl">CON</span>
Mode: ROAD</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="section-direct-despatch-pkg" class="guide-section">
                        <h3 class="editable">2.2 Direct Despatch Package</h3>
                        <div class="menu-path editable">Menu: 2. Departures & Despatches â†’ Direct Despatch Packages</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">End of System</span>
                                <p class="step-text editable">Used for Post/Road to non-VITAL node. Select Next Node (<code>CON</code> or <code>LST</code>). Add Packages (<kbd>Ctrl</kbd> + <kbd>P</kbd>). Press <kbd>Alt</kbd> + <kbd>F2</kbd> to Despatch.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Next Node: <span class="term-hl">CON</span>
Title: CONSIGNEE</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="section-create-pdr" class="guide-section">
                        <h3 class="editable">2.3 Create PDR (1142)</h3>
                        <div class="menu-path editable">Menu: 2. Departures & Despatches â†’ Seq. 1 Maintain PDR</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Header Details</span>
                                <p class="step-text editable">Enter Next Node, Mode (ROAD/COUR), Originator Ref (Dependency), Consigned Via (Sender). Enter Remarks (Serial from PDR OUT folder). Save (<kbd>Alt</kbd> + <kbd>F2</kbd>) to generate PDR No.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Next Node: BIC   Mode: ROAD
Originator Ref: POL</div>
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Add Content</span>
                                <p class="step-text editable">Press <kbd>Alt</kbd> + <kbd>F6</kbd> (Contents). Enter Package IDs. Save. Print 2 copies.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-create-awb" class="guide-section">
                        <h3 class="editable">2.4 Create AWB (1380)</h3>
                        <div class="menu-path editable">Menu: 2. Departures & Despatches â†’ Seq. 6 Bid for Movement</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Create Record</span>
                                <p class="step-text editable">Select Type <code>1380 - AIR WAYBILL</code>. Use Append Mode (<kbd>Ctrl</kbd> + <kbd>O</kbd>). Fill Final Dest Airfield (e.g., USA/BZZ), Move Priority (1), RDD, Import Auth (from Form 22 or NLR).</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Final Dest: <span class="term-hl">USA</span>
Import Auth: <span class="term-hl">22CFR123.4(A)(5)</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Packages & Bid</span>
                                <p class="step-text editable">Add Packages (<kbd>Ctrl</kbd> + <kbd>P</kbd>). Save. Press <kbd>F12</kbd>, Print Labels. Press <kbd>F12</kbd> again, select Recipient (AFC UK Abbey Wood) and Raise Bid (<kbd>Ctrl</kbd> + <kbd>U</kbd>).</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-record-arrival" class="guide-section">
                        <h3 class="editable">3.1 Record Arrival</h3>
                        <div class="menu-path editable">Menu: 3. Arrivals â†’ Seq. 1 Record Arrival</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Scan & Arrive</span>
                                <p class="step-text editable">Enter Package ID manually or use LDT (<kbd>F4</kbd>) for multiple entries. Press <kbd>Ctrl</kbd> + <kbd>B</kbd> to Arrive.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Pkg ID: DBH01232022
Desc: SORBENT, OIL</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="section-node-discrepancies" class="guide-section">
                        <h3 class="editable">3.2 Node Discrepancies (JSP 886)</h3>
                        <div class="menu-path editable">Menu: 3. Arrivals â†’ Seq. 4 Node Discrepancies</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Daily Checks (Omissions)</span>
                                <p class="step-text editable">Check daily for Omissions (OMIS) - items digitally despatched but not physically scanned. You have <strong>48 hours</strong> to investigate.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">ID: DOC   Pkg: WTM02507400   Type: OMIS</div>
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Resolution</span>
                                <p class="step-text editable">Press <kbd>F10</kbd> in Resolution field. Select <code>CLEARED</code> if found, or <code>NOT FOUND</code> to bounce back to consignor (which may require End of System to LST later).</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-temp-locs" class="guide-section">
                        <h3 class="editable">Manage Temporary Locations</h3>
                        <div class="menu-path editable">Menu: 5. Temporary Locations</div>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">View & Allocate</span>
                                <p class="step-text editable"><strong>Seq 1 View:</strong> See list (3QM, 7BN, HANGER1, etc.). Press <kbd>F6</kbd> to print label.<br><strong>Seq 3 Allocate:</strong> <kbd>Ctrl</kbd> + <kbd>P</kbd>. Enter Temp Loc ID and Package ID. Save.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Temp Loc: 3QM
Pkg ID: WTM02516743</div>
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Move & Maintain</span>
                                <p class="step-text editable"><strong>Move All:</strong> <kbd>Ctrl</kbd> + <kbd>G</kbd>. Enter Current and New location.<br><strong>Maintain:</strong> Add new IDs (e.g., NEWLOC) using <kbd>Alt</kbd> + <kbd>F5</kbd>.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-early-bird" class="guide-section">
                        <h3 class="editable">Early Bird Routine</h3>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Node Activity Check</span>
                                <p class="step-text editable">Navigate to <strong>Reports & Queries â†’ Display Node Activity</strong>. Enter Node <code>[NODE]</code> and Activity <code>TO</code> (Due In). Press <kbd>F11</kbd>.</p>
                                <div class="terminal-window">
                                    <div class="terminal-bar"><div class="term-dot red"></div></div>
                                    <div class="terminal-content editable">Node: WTM
Activity: TO</div>
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Print PDRs</span>
                                <p class="step-text editable">Find packages from <code>BIC</code>. Expand consignment (<kbd>F5</kbd>) and Print PDR (<kbd>F6</kbd>). Compare with physical arrival.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-contracts" class="guide-section">
                        <h3 class="editable">Leonardo & Safran</h3>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Safran (Engines)</span>
                                <p class="step-text editable">Receive email (e.g., David Paterson). Print attachments. Create Package for Engine. Generate PDR. Confirm RDD.</p>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Leonardo</span>
                                <p class="step-text editable">1. Create Package ID in VITAL.<br>2. Fill <strong>KN LHUK Road Freight Booking Form</strong> (Booked by, Priority, Dims, Weight).<br>3. In Special Instructions: "Pkg ID, NSN, Item Name, Qty".<br>4. Email to Leonardo Collections.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-dscom" class="guide-section">
                        <h3 class="editable">DSCOM Requests</h3>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Account & Request</span>
                                <p class="step-text editable">Create account (Role: External DMR Op). Create Request: <strong>WHO</strong> (You), <strong>WHEN</strong> (Method: Com Air/Mil Air, Dates), <strong>WHERE</strong> (Consignor POC, Airport: BZZ), <strong>WHAT</strong> (LSE GEN, Pkg ID, Value). Change status to <strong>APPROVED</strong>.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-usa-returns" class="guide-section">
                        <h3 class="editable">USA Returns</h3>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Documentation & Workflow</span>
                                <p class="step-text editable"><strong>Form 22:</strong> Critical. Must list ALL Package IDs, Total Pieces, Value in USD, and Import License (e.g., 22 CFR 123.4(a)(5)).<br><strong>Workflow:</strong> Create VITAL Pkgs/AWB -> Create DSCOM (Do Not Approve) -> Email to Hamilton for Approval -> Once Approved, Upload to DSCOM and Submit.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-kpis" class="guide-section">
                        <h3 class="editable">Weekly Managerial Checks (KPIs)</h3>
                        <div class="step-block">
                            <div class="step-marker">âœ“</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Weekly Requirements</span>
                                <p class="step-text editable">Update Folder every Monday: Packages AT/TO Node, PDR In/Out Registers, Discrepancies, Cleaning Register, Supervisor Alerts.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-hhd" class="guide-section">
                        <h3 class="editable">Handheld Devices (TC72)</h3>
                        <div class="step-block">
                            <div class="step-marker">1</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Priming</span>
                                <p class="step-text editable">Open ASP Gateway. Select <strong>HHD Priming</strong> -> Generate Data. Dock HHD -> Download.</p>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">2</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Updating</span>
                                <p class="step-text editable">Copy zip from Portal to <code>TC72/Internal shared storage/Update</code>.</p>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">3</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">User Mgmt</span>
                                <p class="step-text editable">Use IDAM Portal to Create Users, Reset Passwords, or Change Pins (Requires Re-Prime).</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-supervisor-docs" class="guide-section">
                        <h3 class="editable">Supervisor Annexes</h3>
                        <div class="step-block">
                            <div class="step-marker">A</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Annex A: Account Unlock</span>
                                <p class="step-text editable">Use to unlock user accounts. Upload completed form below.</p>
                                <div class="upload-zone" onclick="triggerUpload(this)">
                                    <div class="upload-icon">ðŸ“„</div>
                                    <span class="upload-text">Upload Annex A Document</span>
                                    <input type="file" hidden accept=".pdf,.docx" onchange="handleFiles(this.files, this)">
                                </div>
                            </div>
                        </div>
                        <div class="step-block">
                            <div class="step-marker">B</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Annex B: Node Creation</span>
                                <p class="step-text editable">Use for creating new VITAL nodes.</p>
                                <div class="upload-zone" onclick="triggerUpload(this)">
                                    <div class="upload-icon">ðŸ“„</div>
                                    <span class="upload-text">Upload Annex B Document</span>
                                    <input type="file" hidden accept=".pdf,.docx" onchange="handleFiles(this.files, this)">
                                </div>
                            </div>
                        </div>
                         <div class="step-block">
                            <div class="step-marker">C</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Annex C: Supervisor Nomination</span>
                                <p class="step-text editable">Use to nominate new VITAL Supervisors.</p>
                                <div class="upload-zone" onclick="triggerUpload(this)">
                                    <div class="upload-icon">ðŸ“„</div>
                                    <span class="upload-text">Upload Annex C Document</span>
                                    <input type="file" hidden accept=".pdf,.docx" onchange="handleFiles(this.files, this)">
                                </div>
                            </div>
                        </div>
                         <div class="step-block">
                            <div class="step-marker">D</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Annex D: Account Deletion/Creation</span>
                                <p class="step-text editable">Use for managing user accounts.</p>
                                <div class="upload-zone" onclick="triggerUpload(this)">
                                    <div class="upload-icon">ðŸ“„</div>
                                    <span class="upload-text">Upload Annex D Document</span>
                                    <input type="file" hidden accept=".pdf,.docx" onchange="handleFiles(this.files, this)">
                                </div>
                            </div>
                        </div>
                         <div class="step-block">
                            <div class="step-marker">F</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Annex F: Deletion Rights</span>
                                <p class="step-text editable">Request rights to delete records.</p>
                                <div class="upload-zone" onclick="triggerUpload(this)">
                                    <div class="upload-icon">ðŸ“„</div>
                                    <span class="upload-text">Upload Annex F Document</span>
                                    <input type="file" hidden accept=".pdf,.docx" onchange="handleFiles(this.files, this)">
                                </div>
                            </div>
                        </div>
                         <div class="step-block">
                            <div class="step-marker">G</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Annex G: Node Change</span>
                                <p class="step-text editable">Request to change a user's assigned node.</p>
                                <div class="upload-zone" onclick="triggerUpload(this)">
                                    <div class="upload-icon">ðŸ“„</div>
                                    <span class="upload-text">Upload Annex G Document</span>
                                    <input type="file" hidden accept=".pdf,.docx" onchange="handleFiles(this.files, this)">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="section-deletions" class="guide-section">
                        <h3 class="editable">Deletion of Records</h3>
                        <div class="step-block">
                            <div class="step-marker">ðŸ—‘</div>
                            <div class="step-detail">
                                <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                                <span class="step-title editable">Procedure</span>
                                <p class="step-text editable">Supervisors can delete unused records. <strong>Note:</strong> Packages must be removed from PDRs/AWBs first. Recall record, tab to Delete field, enter <code>Y</code>, Save.</p>
                            </div>
                        </div>
                    </div>

                    <div id="section-lsai-viewer" class="guide-section">
                        <h3 class="editable">LSA&I Handbook Viewer</h3>
                        <div class="step-block">
                            <div class="step-marker">ðŸ“</div>
                            <div class="step-detail">
                                <span class="step-title">Load Handbook Document</span>
                                <p class="step-text">Upload the LSA&I Handbook (.docx or .pdf) to view it in the frame below.</p>
                                <input type="file" id="lsai-file-input" accept=".pdf,.docx" onchange="loadLsaiDocument(this)" style="margin-bottom: 15px;">
                                <div id="lsai-doc-container" class="doc-viewer-container">
                                    <div class="doc-viewer-placeholder">
                                        <p>No document loaded.</p>
                                        <p style="font-size:0.8em">Select a file above to view.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        // Prevent Context Menu
        document.addEventListener('contextmenu', event => event.preventDefault());
        
        // LOG SIGNATURE
        console.log("LSS Guide System v2.1 - Authorized Use Only - Developed by K.R.I.S. K.I.R.B.Y");

        // Initialize listeners for drag and drop
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.upload-zone').forEach(addDragDropListeners);
            document.body.addEventListener('input', () => {
                if (document.body.classList.contains('editing')) {
                    autoSave();
                }
            });
            loadTestConfig(); // Load Saved Tests
        });

        // Mobile Nav Toggle
        function toggleMobileNav() {
            const sidebar = document.getElementById('sidebar-nav');
            const overlay = document.getElementById('mobile-overlay');
            sidebar.classList.toggle('mobile-open');
            overlay.style.display = sidebar.classList.contains('mobile-open') ? 'block' : 'none';
        }

        // Close nav when clicking a link on mobile
        function closeNavMobile() {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar-nav');
                const overlay = document.getElementById('mobile-overlay');
                sidebar.classList.remove('mobile-open');
                overlay.style.display = 'none';
            }
        }

        function autoSave() {
            const indicator = document.getElementById('auto-save-indicator');
            indicator.style.opacity = '1';
            setTimeout(() => { indicator.style.opacity = '0'; }, 2000);
            localStorage.setItem('lss-guides-content', document.querySelector('.content-body').innerHTML);
        }

        function addDragDropListeners(zone) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                zone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }

            ['dragenter', 'dragover'].forEach(eventName => {
                zone.addEventListener(eventName, () => zone.classList.add('dragover'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                zone.addEventListener(eventName, () => zone.classList.remove('dragover'), false);
            });

            zone.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                let dt = e.dataTransfer;
                let files = dt.files;
                handleFiles(files, zone);
            }
        }

        function handleFiles(files, zone) {
            if (files.length > 0) {
                let file = files[0];
                if (file.type.startsWith('image/')) {
                    let reader = new FileReader();
                    reader.onload = function(e) {
                        let img = zone.querySelector('img');
                        let icon = zone.querySelector('.upload-icon');
                        let text = zone.querySelector('.upload-text');
                        img.src = e.target.result;
                        img.style.display = 'block';
                        icon.style.display = 'none';
                        text.style.display = 'none';
                    }
                    reader.readAsDataURL(file);
                }
            }
        }

        function loadLsaiDocument(input) {
            const container = document.getElementById('lsai-doc-container');
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                if (file.type === "application/pdf") {
                    reader.onload = function(e) {
                        container.innerHTML = `<iframe src="${e.target.result}" class="doc-viewer-frame"></iframe>`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    container.innerHTML = `
                        <div class="doc-viewer-placeholder">
                            <p><strong>${file.name}</strong> loaded.</p>
                            <p>Word documents cannot be rendered inline. Please convert to PDF.</p>
                        </div>
                    `;
                }
            }
        }

        function downloadHtml() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Sgt_Kirbys_LSS_Guides_v2.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function enterSystem(system) {
            document.getElementById('cover-page').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('app-container').classList.add('visible');
                
                document.getElementById('nav-content-vital').style.display = 'none';
                document.getElementById('nav-content-mjdi').style.display = 'none';
                document.getElementById('nav-content-lsai').style.display = 'none';

                if (system === 'mjdi-lsai') {
                    document.getElementById('nav-content-lsai').style.display = 'block';
                    document.getElementById('guide-title').innerText = 'LSA&I Tool';
                    showSection('lsai-viewer');
                } else if (system === 'mjdi') {
                    document.getElementById('nav-content-mjdi').style.display = 'block';
                    document.getElementById('guide-title').innerText = 'MJDI Guide';
                    showSection('mjdi-receipts'); 
                } else {
                    document.getElementById('nav-content-vital').style.display = 'block';
                    document.getElementById('guide-title').innerText = 'VITAL Guide';
                    showSection('welcome');
                }
                // Refresh select box if admin panel is open
                if (document.getElementById('admin-panel').classList.contains('open')) {
                    populateSectionSelect();
                    populateCategoryDeleteSelect();
                }
            }, 300);
        }

        function goHome() {
            document.getElementById('app-container').classList.remove('visible');
            setTimeout(() => {
                document.getElementById('cover-page').classList.remove('hidden');
            }, 300);
        }

        function toggleNav(button) {
            button.classList.toggle('active');
            var content = button.nextElementSibling;
            content.classList.toggle('open');
        }

        function showSection(sectionId) {
            var sections = document.querySelectorAll('.guide-section');
            sections.forEach(s => s.classList.remove('active'));
            var target = document.getElementById('section-' + sectionId);
            if(target) {
                target.classList.add('active');
                document.querySelector('.main-viewport').scrollTop = 0;
            }
        }

        function triggerUpload(element) {
            element.querySelector('input').click();
        }

        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var zone = input.parentElement;
                    var img = zone.querySelector('img');
                    var icon = zone.querySelector('.upload-icon');
                    var text = zone.querySelector('.upload-text');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    icon.style.display = 'none';
                    text.style.display = 'none';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        /* =================================
           TEST SYSTEM LOGIC & ADMIN
           ================================= */
        let testScore = 0;
        let currentQuestion = 0;
        let vitalQuestions = [];
        
        // Default questions if none saved
        const defaultQuestions = [
            {
                type: 'mc',
                question: 'What is the standard VITAL shortcut to display the "List of Nodes" popup?',
                options: ['F1', 'F3', 'F10', 'Ctrl + P'],
                correct: 1,
                image: ''
            },
            {
                type: 'terminal',
                question: 'SIMULATION: You are creating an Issue Package. The system asks for "Final Node". Enter the code for Bicester.',
                answer: 'BIC',
                image: ''
            },
            {
                type: 'hotkey',
                question: 'HOTKEY CHALLENGE: Press the physical key on your keyboard used to "Confirm/Save" a transaction in VITAL (Legacy Shortcut).',
                key: 'F2',
                hint: 'It is usually combined with Alt',
                image: ''
            },
            {
                type: 'mc',
                question: 'When a package is showing as "OMIS" (Omission) on the Node Activity check, how many hours do you have to investigate?',
                options: ['24 Hours', '48 Hours', '7 Days', 'Immediate'],
                correct: 1,
                image: ''
            },
            {
                type: 'terminal',
                question: 'SIMULATION: You have entered all Item Details. Enter the hotkey command string to "Create Packages" now.',
                answer: 'CTRL+P',
                image: ''
            }
        ];

        function loadTestConfig() {
            const saved = localStorage.getItem('vt-questions');
            if (saved) {
                vitalQuestions = JSON.parse(saved);
            } else {
                vitalQuestions = JSON.parse(JSON.stringify(defaultQuestions));
            }
        }

        function saveTestConfig() {
            localStorage.setItem('vt-questions', JSON.stringify(vitalQuestions));
            loadTestConfig();
            renderAdminQuestionList();
        }

        function openTestHub() {
            document.getElementById('cover-page').classList.add('hidden');
            const hub = document.getElementById('test-hub');
            hub.style.display = 'flex';
            setTimeout(() => { hub.classList.add('visible'); }, 100);
        }

        function closeTestHub() {
            const hub = document.getElementById('test-hub');
            hub.classList.remove('visible');
            setTimeout(() => { 
                hub.style.display = 'none'; 
                document.getElementById('cover-page').classList.remove('hidden');
            }, 500);
        }

        function startVitalTest() {
            loadTestConfig();
            document.getElementById('test-hub').classList.remove('visible');
            setTimeout(() => { document.getElementById('test-hub').style.display = 'none'; }, 500);
            
            const testContainer = document.getElementById('vital-test-container');
            testContainer.style.display = 'flex';
            
            testScore = 0;
            currentQuestion = 0;
            updateScore();
            renderQuestion();
        }

        function closeVitalTest() {
            document.getElementById('vital-test-container').style.display = 'none';
            document.removeEventListener('keydown', handleHotKeyTest); 
            openTestHub();
        }

        function updateScore() {
            document.getElementById('vt-score').innerText = `SCORE: ${testScore}/${vitalQuestions.length}`;
        }

        function renderQuestion() {
            const qData = vitalQuestions[currentQuestion];
            const area = document.getElementById('vt-game-area');
            area.innerHTML = ''; 

            const qText = document.createElement('div');
            qText.className = 'vt-question-box';
            
            let html = `<div class="vt-question-text">Q${currentQuestion + 1}: ${qData.question}</div>`;
            
            if (qData.image && qData.image.length > 5) {
                html += `<img src="${qData.image}" class="vt-question-image" alt="Reference Image">`;
            }
            
            qText.innerHTML = html;
            
            if (qData.type === 'mc') {
                const optsDiv = document.createElement('div');
                optsDiv.className = 'vt-options';
                qData.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'vt-option-btn';
                    btn.innerText = `> ${opt}`;
                    btn.onclick = () => checkMCAnswer(idx, qData.correct, btn);
                    optsDiv.appendChild(btn);
                });
                qText.appendChild(optsDiv);
            } else if (qData.type === 'terminal') {
                qText.innerHTML += `
                    <div style="color:#aaa; font-size:0.9rem; margin-bottom:5px;">TERMINAL INPUT_</div>
                    <input type="text" class="vt-terminal-input" id="vt-input" placeholder="Type command..." autocomplete="off">
                    <button class="vt-next-btn" id="term-submit" style="display:inline-block;" onclick="checkTermAnswer('${qData.answer}')">SUBMIT</button>
                    <div id="term-feedback" style="margin-top:10px; font-weight:bold;"></div>
                `;
            } else if (qData.type === 'hotkey') {
                qText.innerHTML += `
                    <div style="text-align:center; padding:40px; border:2px dashed #0f0; margin-top:20px;">
                        Waiting for Key Press...
                        <div id="key-press-display" style="font-size:2rem; margin-top:20px;"></div>
                    </div>
                `;
                document.addEventListener('keydown', handleHotKeyTest);
            }

            area.appendChild(qText);

            const nextBtn = document.createElement('button');
            nextBtn.id = 'global-next-btn';
            nextBtn.className = 'vt-next-btn';
            nextBtn.innerText = 'NEXT QUESTION >>';
            nextBtn.onclick = nextQuestion;
            area.appendChild(nextBtn);
        }

        function checkMCAnswer(selectedIdx, correctIdx, btn) {
            const allBtns = document.querySelectorAll('.vt-option-btn');
            allBtns.forEach(b => b.disabled = true);
            // Ensure correctIdx is a number
            if (selectedIdx === parseInt(correctIdx)) {
                btn.classList.add('correct');
                testScore++;
            } else {
                btn.classList.add('wrong');
                if(allBtns[correctIdx]) allBtns[correctIdx].classList.add('correct');
            }
            updateScore();
            document.getElementById('global-next-btn').style.display = 'block';
        }

        function checkTermAnswer(correctAnswer) {
            const input = document.getElementById('vt-input');
            const feedback = document.getElementById('term-feedback');
            const userVal = input.value.toUpperCase().replace(/\s/g, '');
            const correctVal = correctAnswer.toUpperCase().replace(/\s/g, '');

            if (userVal === correctVal) {
                feedback.style.color = '#0f0';
                feedback.innerText = 'ACCESS GRANTED.';
                testScore++;
            } else {
                feedback.style.color = '#c00';
                feedback.innerText = `ACCESS DENIED. CORRECT COMMAND: ${correctAnswer}`;
            }
            document.getElementById('term-submit').disabled = true;
            input.disabled = true;
            updateScore();
            document.getElementById('global-next-btn').style.display = 'block';
        }

        function handleHotKeyTest(e) {
            e.preventDefault(); 
            const display = document.getElementById('key-press-display');
            const qData = vitalQuestions[currentQuestion];
            if(!display) return; 

            const pressed = e.key.toUpperCase();
            const required = qData.key.toUpperCase();

            if (pressed === required) {
                display.style.color = '#0f0';
                display.innerText = `DETECTED: ${pressed} - CORRECT`;
                testScore++;
                document.removeEventListener('keydown', handleHotKeyTest);
                updateScore();
                document.getElementById('global-next-btn').style.display = 'block';
            } else {
                display.style.color = '#c00';
                display.innerText = `DETECTED: ${pressed}`;
                setTimeout(() => { display.innerText = ""; }, 500);
            }
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < vitalQuestions.length) {
                renderQuestion();
            } else {
                const area = document.getElementById('vt-game-area');
                area.innerHTML = `
                    <div class="vt-question-box" style="text-align:center;">
                        <h2 style="color:#0f0; font-size:2rem;">TEST COMPLETE</h2>
                        <div style="font-size:4rem; margin:20px 0;">${testScore} / ${vitalQuestions.length}</div>
                        <p>${testScore >= (vitalQuestions.length * 0.8) ? 'EXCELLENT WORK, SPECIALIST.' : 'REVISION REQUIRED.'}</p>
                    </div>
                `;
            }
        }

        /* ===========================
           TEST ADMIN LOGIC
           =========================== */
        function openVtAdmin() {
            // Password check just like main admin
            const pin = prompt("ENTER ROOT PIN:");
            if (pin === '1134') {
                document.getElementById('vt-admin-panel').style.display = 'flex';
                renderAdminQuestionList();
            }
        }

        function closeVtAdmin() {
            document.getElementById('vt-admin-panel').style.display = 'none';
        }

        function renderAdminQuestionList() {
            const list = document.getElementById('vt-q-list');
            list.innerHTML = '';
            vitalQuestions.forEach((q, idx) => {
                const item = document.createElement('div');
                item.className = 'vt-admin-item';
                item.innerHTML = `<span>${idx + 1}. ${q.question.substring(0, 30)}...</span> <span>[${q.type}]</span>`;
                item.onclick = () => loadQuestionForEdit(idx);
                list.appendChild(item);
            });
        }

        function toggleVtFields() {
            const type = document.getElementById('vt-type').value;
            document.getElementById('vt-group-mc').style.display = type === 'mc' ? 'block' : 'none';
            document.getElementById('vt-group-ans').style.display = type !== 'mc' ? 'block' : 'none';
        }

        function clearVtForm() {
            document.getElementById('vt-edit-index').value = "-1";
            document.getElementById('vt-qtext').value = "";
            document.getElementById('vt-img-url').value = "";
            document.getElementById('vt-options').value = "";
            document.getElementById('vt-correct-idx').value = "";
            document.getElementById('vt-answer').value = "";
            document.querySelectorAll('.vt-admin-item').forEach(i => i.classList.remove('active'));
            toggleVtFields();
        }

        function loadQuestionForEdit(idx) {
            clearVtForm();
            const q = vitalQuestions[idx];
            document.getElementById('vt-edit-index').value = idx;
            document.getElementById('vt-type').value = q.type;
            document.getElementById('vt-qtext').value = q.question;
            document.getElementById('vt-img-url').value = q.image || "";
            
            toggleVtFields();

            if (q.type === 'mc') {
                document.getElementById('vt-options').value = q.options.join(', ');
                document.getElementById('vt-correct-idx').value = q.correct;
            } else if (q.type === 'terminal') {
                document.getElementById('vt-answer').value = q.answer;
            } else if (q.type === 'hotkey') {
                document.getElementById('vt-answer').value = q.key;
            }

            // Highlight in list
            const listItems = document.querySelectorAll('.vt-admin-item');
            if(listItems[idx]) listItems[idx].classList.add('active');
        }

        function handleVtImageUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('vt-img-url').value = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveQuestionData() {
            const idx = parseInt(document.getElementById('vt-edit-index').value);
            const type = document.getElementById('vt-type').value;
            const qtext = document.getElementById('vt-qtext').value;
            const img = document.getElementById('vt-img-url').value;

            if (!qtext) { alert("Question text required"); return; }

            const newQ = {
                type: type,
                question: qtext,
                image: img
            };

            if (type === 'mc') {
                const opts = document.getElementById('vt-options').value.split(',').map(s => s.trim());
                const correct = parseInt(document.getElementById('vt-correct-idx').value);
                if (opts.length < 2) { alert("Need at least 2 options"); return; }
                if (isNaN(correct) || correct >= opts.length) { alert("Invalid Correct Index"); return; }
                newQ.options = opts;
                newQ.correct = correct;
            } else if (type === 'terminal') {
                newQ.answer = document.getElementById('vt-answer').value;
            } else if (type === 'hotkey') {
                newQ.key = document.getElementById('vt-answer').value;
            }

            if (idx === -1) {
                vitalQuestions.push(newQ);
            } else {
                vitalQuestions[idx] = newQ;
            }

            saveTestConfig();
            alert("Question Saved.");
            clearVtForm();
        }

        function deleteQuestionData() {
            const idx = parseInt(document.getElementById('vt-edit-index').value);
            if (idx === -1) return;
            if (confirm("Delete this question?")) {
                vitalQuestions.splice(idx, 1);
                saveTestConfig();
                clearVtForm();
            }
        }

        // ADMIN FUNCTIONS (Existing)
        let currentSectionId = '';
        document.addEventListener('click', function(e) {
            const activeSection = document.querySelector('.guide-section.active');
            if(activeSection) currentSectionId = activeSection.id;
        });

        function showAdminLogin() {
            document.getElementById('admin-login-overlay').style.display = 'flex';
            document.getElementById('admin-pin').value = '';
            document.getElementById('admin-pin').focus();
        }

        function closeAdminLogin() {
            document.getElementById('admin-login-overlay').style.display = 'none';
        }

        function checkAdminPin() {
            const pin = document.getElementById('admin-pin').value;
            if (pin === '1134') {
                closeAdminLogin();
                openAdminPanel();
            } else {
                alert('Access Denied. Incorrect PIN.');
            }
        }

        function openAdminPanel() {
            document.getElementById('admin-panel').classList.add('open');
            populateSectionSelect();
            populateCategoryDeleteSelect();
        }

        function toggleAdminPanel() {
            document.getElementById('admin-panel').classList.toggle('open');
        }

        function toggleEditMode() {
            document.body.classList.toggle('editing');
            const btn = document.getElementById('toggle-edit-btn');
            if (document.body.classList.contains('editing')) {
                btn.innerText = "Disable Text Editing";
                btn.style.background = "#f56565";
                document.querySelectorAll('.editable').forEach(el => el.contentEditable = "true");
            } else {
                btn.innerText = "Enable Text Editing";
                btn.style.background = "#3b82f6";
                document.querySelectorAll('.editable').forEach(el => el.contentEditable = "false");
            }
        }

        function populateSectionSelect() {
            const select = document.getElementById('target-section-select');
            select.innerHTML = '';
            
            let activeContainer = '';
            if (document.getElementById('nav-content-vital').style.display !== 'none') {
                activeContainer = 'nav-content-vital';
            } else if (document.getElementById('nav-content-mjdi').style.display !== 'none') {
                activeContainer = 'nav-content-mjdi';
            } else if (document.getElementById('nav-content-lsai').style.display !== 'none') {
                activeContainer = 'nav-content-lsai';
            }

            const allSections = document.querySelectorAll('.guide-section');
            
            allSections.forEach(sec => {
                let isMjdiSection = sec.id.startsWith('section-mjdi-');
                let isLsaiSection = sec.id.startsWith('section-lsai-');
                let show = false;

                if (activeContainer === 'nav-content-mjdi' && isMjdiSection) show = true;
                if (activeContainer === 'nav-content-lsai' && isLsaiSection) show = true;
                if (activeContainer === 'nav-content-vital' && !isMjdiSection && !isLsaiSection) show = true;

                if (show) {
                    const h3 = sec.querySelector('h3');
                    const title = h3 ? h3.innerText : sec.id;
                    const opt = document.createElement('option');
                    opt.value = sec.id;
                    opt.innerText = title;
                    if (sec.classList.contains('active')) opt.selected = true;
                    select.appendChild(opt);
                }
            });
        }

        function populateCategoryDeleteSelect() {
            const select = document.getElementById('delete-category-select');
            select.innerHTML = '';
            
            let activeContainerId = '';
            if (document.getElementById('nav-content-vital').style.display !== 'none') activeContainerId = 'nav-content-vital';
            else if (document.getElementById('nav-content-mjdi').style.display !== 'none') activeContainerId = 'nav-content-mjdi';
            else if (document.getElementById('nav-content-lsai').style.display !== 'none') activeContainerId = 'nav-content-lsai';

            if (!activeContainerId) return;

            const groups = document.getElementById(activeContainerId).querySelectorAll('.nav-group');
            groups.forEach((group, index) => {
                const trigger = group.querySelector('.nav-trigger');
                const opt = document.createElement('option');
                opt.value = index;
                opt.innerText = trigger.textContent.replace('â–¼', '').trim();
                select.appendChild(opt);
            });
        }

        function deleteCategory() {
            const select = document.getElementById('delete-category-select');
            const index = select.value;
            if (index === "") return;

            if (confirm("Are you sure you want to delete this entire category and its contents?")) {
                let activeContainerId = '';
                if (document.getElementById('nav-content-vital').style.display !== 'none') activeContainerId = 'nav-content-vital';
                else if (document.getElementById('nav-content-mjdi').style.display !== 'none') activeContainerId = 'nav-content-mjdi';
                else if (document.getElementById('nav-content-lsai').style.display !== 'none') activeContainerId = 'nav-content-lsai';
                
                const groups = document.getElementById(activeContainerId).querySelectorAll('.nav-group');
                if (groups[index]) {
                    groups[index].remove();
                    alert("Category deleted.");
                    populateCategoryDeleteSelect();
                    autoSave();
                }
            }
        }

        document.getElementById('include-term').addEventListener('change', function() {
            document.getElementById('term-content-group').style.display = 
                this.value === 'yes' ? 'block' : 'none';
        });

        function deleteStep(btn) {
            if (confirm('Are you sure you want to delete this step?')) {
                const stepBlock = btn.closest('.step-block');
                stepBlock.remove();
                autoSave();
            }
        }
        
        function addNewCategory() {
            const guideSelect = document.getElementById('target-guide-select').value;
            const title = document.getElementById('new-category-title').value;
            if (!title) { alert('Please enter a category title.'); return; }
            
            const navContainer = document.getElementById(guideSelect);
            const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
            const sectionId = 'section-' + slug;
            
            const navGroup = document.createElement('div');
            navGroup.className = 'nav-group';
            navGroup.innerHTML = `
                <button class="nav-trigger" onclick="toggleNav(this)">${title} <span class="arrow">â–¼</span></button>
                <div class="nav-content">
                    <a href="#" class="nav-link" onclick="closeNavMobile(); showSection('${sectionId}')">${title} Overview</a>
                </div>
            `;
            navContainer.appendChild(navGroup);
            
            const contentBody = document.querySelector('.content-body');
            const newSection = document.createElement('div');
            newSection.id = sectionId;
            newSection.className = 'guide-section';
            newSection.innerHTML = `<h3 class="editable">${title}</h3><p class="step-text editable">New section created. Use Admin Panel to add steps.</p>`;
            contentBody.appendChild(newSection);
            
            autoSave();
            alert('Category added!');
            populateSectionSelect();
            populateCategoryDeleteSelect();
        }

        function addNewStep() {
            const sectionId = document.getElementById('target-section-select').value;
            const num = document.getElementById('new-step-num').value;
            const title = document.getElementById('new-step-title').value;
            const text = document.getElementById('new-step-text').value;
            const includeTerm = document.getElementById('include-term').value === 'yes';
            const termText = document.getElementById('new-term-text').value;

            if (!sectionId) { alert('Please select a section.'); return; }
            const section = document.getElementById(sectionId);
            
            const stepBlock = document.createElement('div');
            stepBlock.className = 'step-block';
            
            let html = `
                <div class="step-marker">${num}</div>
                <div class="step-detail">
                    <button class="delete-step-btn" onclick="deleteStep(this)">Delete</button>
                    <span class="step-title editable">${title}</span>
                    <p class="step-text editable">${text}</p>
            `;

            if (includeTerm) {
                html += `<div class="terminal-window"><div class="terminal-bar"><div class="term-dot red"></div></div><div class="terminal-content editable">${termText}</div></div>`;
            }

            html += `<div class="upload-zone" onclick="triggerUpload(this)"><div class="upload-icon">ðŸ“¸</div><span class="upload-text">Click or Drag image here</span><input type="file" hidden accept="image/*" onchange="previewImage(this)"><img src=""></div></div>`;

            stepBlock.innerHTML = html;
            section.appendChild(stepBlock);
            addDragDropListeners(stepBlock.querySelector('.upload-zone'));

            if (document.body.classList.contains('editing')) {
                stepBlock.querySelectorAll('.editable').forEach(el => el.contentEditable = "true");
            }
            
            autoSave();
            alert('Step added successfully!');
        }

        function saveChanges() {
            alert('Changes applied to current session. To make them permanent, you would need to save the HTML file.');
            console.log("Current HTML state ready for export.");
        }
    </script>
</body>
</html>
